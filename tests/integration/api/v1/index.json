{
  "openapi": "3.0.0",
  "info": {
    "version": "1.3.0",
    "title": "Onetime Secret API v1",
    "description": "Version 1 of the Onetime Secret API"
  },
  "servers": [
    {
      "url": "https://onetimesecret.com",
      "description": "Production - Cloudflare LB (Global)",
      "variables": {}
    },
    {
      "url": "https://eu.onetimesecret.com",
      "description": "Production - Cloudflare LB (Europe)",
      "variables": {}
    },
    {
      "url": "https://us.onetimesecret.com",
      "description": "Production - Cloudflare LB (U.S.)",
      "variables": {}
    },
    {
      "url": "https://staging.onetimesecret.com",
      "description": "Staging on fly.io (ams)",
      "variables": {}
    },
    {
      "url": "https://dev.onetimesecret.com",
      "description": "Local development",
      "variables": {}
    }
  ],
  "paths": {
    "/v1/private/{metadata_key}/burn": {
          "post": {
            "summary": "Burn a secret",
            "parameters": [
              {
                "name": "metadata_key",
                "in": "path",
                "required": true,
                "schema": {
                  "type": "string"
                }
              }
            ],
            "responses": {
              "200": {
                "description": "Successful response"
              }
            },
            "tags": [
              "v1",
              "secrets",
              "metadata",
              "danger"
            ]
          }
        },
    "/v1/private/{metadata_key}": {
          "post": {
            "summary": "Retrieve metadata",
            "parameters": [
              {
                "name": "metadata_key",
                "in": "path",
                "required": true,
                "schema": {
                  "type": "string"
                }
              }
            ],
            "responses": {
              "200": {
                "description": "Successful response"
              }
            },
            "tags": [
              "v1",
              "secrets",
              "metadata"
            ]
          }
        },
    "/v1/private/recent": {
          "get": {
            "summary": "Retrieve recent metadata",
            "responses": {
              "200": {
                "description": "Successful response"
              }
            },
            "tags": [
              "v1",
              "secrets",
              "metadata",
              "readonly"
            ]
          }
        },
    "/v1/share": {
          "post": {
            "summary": "Create a secret",
            "requestBody": {
              "required": true,
              "content": {
                "application/x-www-form-urlencoded": {
                  "schema": {
                    "type": "object",
                    "properties": {
                      "secret": {
                        "type": "string"
                      },
                      "ttl": {
                        "type": "string"
                      },
                      "passphrase": {
                        "type": "string"
                      },
                      "recipient": {
                        "type": "string"
                      },
                      "kind": {
                        "type": "string"
                      },
                      "share_domain": {
                        "type": "string"
                      }
                    },
                    "required": [
                      "secret"
                    ]
                  }
                }
              }
            },
            "responses": {
              "200": {
                "description": "Successful response",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ShareV1ApiResponse"
                    }
                  }
                }
              }
            }
            ,
            "tags": [
              "v1",
              "secrets",
              "create"
            ]
          }
        },
    "/v1/generate": {
          "post": {
            "summary": "Generate a secret",
            "responses": {
              "200": {
                "description": "Successful response",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/ConcealDataApiResponse"
                    }
                  }
                }
              }
            }
            ,
            "tags": [
              "v1",
              "secrets",
              "create"
            ]
          }
        },
    "/v1/secret/{secret_key}": {
          "post": {
            "summary": "Retrieve a secret",
            "parameters": [
              {
                "name": "secret_key",
                "in": "path",
                "required": true,
                "schema": {
                  "type": "string"
                }
              }
            ],
            "responses": {
              "200": {
                "description": "Successful response",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/SecretDataApiResponse"
                    }
                  }
                }
              }
            }
            ,
            "tags": [
              "v1",
              "secrets",
              "reveal",
              "danger"
            ]
          }
        },
    "/v1/status": {
          "get": {
            "summary": "Get system status",
            "responses": {
              "200": {
                "description": "Successful response",
                "content": {
                  "application/json": {
                    "schema": {
                      "$ref": "#/components/schemas/BaseApiResponse"
                    }
                  }
                }
              }
            }
            ,
            "tags": [
              "v1",
              "readonly"
            ]
          },
          "head": {
            "summary": "Head system status",
            "responses": {
              "200": {
                "description": "Successful response"
              }
            },
            "tags": [
              "v1",
              "readonly"
            ]
          }
        }
  },
  "components": {
    "schemas": {
      "BaseApiResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          }
        },
        "required": [
          "success"
        ]
      },

      "Metadata": {
        "allOf": [
          {
            "$ref": "#/components/schemas/DashboardMetadata"
          },
          {
            "type": "object",
            "properties": {
              "custid": {
                "type": "string"
              },
              "state": {
                "type": "string"
              },
              "secret_key": {
                "type": "string"
              },
              "secret_shortkey": {
                "type": "string"
              },
              "secret_ttl": {
                "type": "number"
              },
              "share_domain": {
                "type": "string"
              },
              "passphrase": {
                "type": "string"
              },
              "viewed": {
                "type": "boolean"
              },
              "received": {
                "type": "boolean"
              },
              "shared": {
                "type": "boolean"
              },
              "burned": {
                "type": "boolean"
              },
              "recipients": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "truncate": {
                "type": "boolean"
              },
              "key": {
                "type": "string"
              }
            },
            "required": [
              "custid",
              "state",
              "secret_key",
              "secret_shortkey",
              "secret_ttl",
              "share_domain",
              "passphrase",
              "viewed",
              "received",
              "shared",
              "burned",
              "recipients",
              "truncate",
              "key"
            ]
          }
        ]
      },
      "Secret": {
        "allOf": [
          {
            "$ref": "./APIv2.json#/components/schemas/BaseApiV2Record"
          },
          {
            "type": "object",
            "properties": {
              "custid": {
                "type": "string"
              },
              "state": {
                "type": "string"
              },
              "value": {
                "type": "string"
              },
              "metadata_key": {
                "type": "string"
              },
              "original_size": {
                "type": "number"
              },
              "value_checksum": {
                "type": "string"
              },
              "value_encryption": {
                "type": "string"
              },
              "lifespan": {
                "type": "number"
              },
              "share_domain": {
                "type": "string"
              },
              "verification": {
                "type": "string"
              },
              "is_truncated": {
                "type": "boolean"
              },
              "maxviews": {
                "type": "number"
              }
            },
            "required": [
              "custid",
              "state",
              "value",
              "metadata_key",
              "original_size",
              "value_checksum",
              "value_encryption",
              "lifespan",
              "share_domain",
              "verification",
              "is_truncated",
              "maxviews"
            ]
          }
        ]
      },
      "ShareV1ApiResponse": {
        "type": "object",
        "properties": {
          "secret_key": {
            "type": "string"
          },
          "metadata_key": {
            "type": "string"
          },
          "secret_ttl": {
            "type": "number"
          },
          "passphrase_required": {
            "type": "boolean"
          },
          "created": {
            "type": "number"
          }
        },
        "required": [
          "secret_key",
          "metadata_key",
          "secret_ttl",
          "passphrase_required",
          "created"
        ]
      },
      "BaseApiV1Response": {
        "type": "object",
        "properties": {
          "custid": {
            "type": "string"
          },
          "created": {
            "type": "string"
          },
          "updated": {
            "type": "string"
          }
        }
      },
      "StatusResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": ["nominal", "offline"]
          }
        }
      },
      "ShareSecretResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseApiV1Response"
          },
          {
            "type": "object",
            "properties": {
              "metadata_key": {
                "type": "string"
              },
              "secret_key": {
                "type": "string"
              },
              "ttl": {
                "type": "string"
              },
              "share_domain": {
                "type": "string"
              }
            }
          }
        ]
      },
      "GenerateSecretResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseApiV1Response"
          },
          {
            "type": "object",
            "properties": {
              "value": {
                "type": "string"
              },
              "metadata_key": {
                "type": "string"
              },
              "secret_key": {
                "type": "string"
              },
              "ttl": {
                "type": "string"
              },
              "share_domain": {
                "type": "string"
              }
            }
          }
        ]
      },
      "RetrieveSecretResponse": {
        "type": "object",
        "properties": {
          "secret_key": {
            "type": "string"
          },
          "value": {
            "type": "string"
          }
        }
      },
      "MetadataResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/BaseApiV1Response"
          },
          {
            "type": "object",
            "properties": {
              "metadata_key": {
                "type": "string"
              },
              "secret_key": {
                "type": "string"
              },
              "ttl": {
                "type": "string"
              },
              "metadata_ttl": {
                "type": "integer"
              },
              "secret_ttl": {
                "type": "integer"
              },
              "recipient": {
                "type": "string"
              },
              "received": {
                "type": "string"
              },
              "passphrase_required": {
                "type": "boolean"
              }
            }
          }
        ]
      },
      "BurnSecretResponse": {
        "allOf": [
          {
            "$ref": "#/components/schemas/MetadataResponse"
          },
          {
            "type": "object",
            "properties": {
              "status": {
                "type": "string",
                "enum": ["burned"]
              }
            }
          }
        ]
      },
      "RecentMetadataResponse": {
        "type": "array",
        "items": {
          "allOf": [
            {
              "$ref": "#/components/schemas/MetadataResponse"
            },
            {
              "type": "object",
              "properties": {
                "secret_key": {
                  "type": "null"
                }
              }
            }
          ]
        }
      }

    },
    "securitySchemes": {
      "BasicAuth": {
        "type": "http",
        "scheme": "basic"
      }
    }
  },
  "security": [
    {
      "BasicAuth": []
    }
  ]
}
